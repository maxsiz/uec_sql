--r4,part1
SELECT SUBSTR(T.CARD_NUM,2) as NUM, O.CODE as CARRIER, count (*) as TRIP_COUNT
--,T.AMOUNT AS TARIF
,0 as TARIF
, decode(R.ID_CODE_MSG,200001000,1,0) as VID
--, T.*
 FROM CPTT.T_DATA T
    INNER JOIN CPTT.DIVISION D ON T.ID_DIVISION=D.ID
    INNER JOIN CPTT.OPERATOR O ON D.ID_OPERATOR=O.ID  and O.ROLE=1
    INNER JOIN CPTT.ROUTE R ON T.id_route=R.ID AND T.id_division = R.id_division
 WHERE 
     T.CARD_SERIES  in (83) 
     and   O.CODE !='0080'
     --and O.CODE in ('0002','0003','0004','0005','0006','0007','0008','0009','0011','0012','0013','0014','0015','0016','0017','0018','0019','0020','0021','0022','0023','0024','0025','0026','0027','0028','0062')  
AND   T.KIND=17 
AND TO_CHAR(TRUNC(T.DATE_OF,'MM'), 'DDMMYYYY') = '01092016'
--AND T.INS_DATE < TO_DATE('02.08.2016  05:45:00','DD.MM.YYYY HH24:MI:SS')
and T.CARD_NUM  not in ('0003027271', '0003024299')
and  decode(R.ID_CODE_MSG,200001000,1,0) = 1 -- только городские
GROUP BY SUBSTR(T.CARD_NUM,2), O.CODE, T.AMOUNT, decode(R.ID_CODE_MSG,200001000,1,0) 
ORDER BY decode(R.ID_CODE_MSG,200001000,1,0),O.CODE, T.AMOUNT, SUBSTR(T.CARD_NUM,2) 
--r4,part2
SELECT SUBSTR(T.CARD_NUM,2) as NUM, O.CODE as CARRIER, count (*) as TRIP_COUNT
,16 AS TARIF
, decode(R.ID_CODE_MSG,200001000,1,0) as VID
--, T.*
 FROM CPTT.T_DATA T
    INNER JOIN CPTT.DIVISION D ON T.ID_DIVISION=D.ID
    INNER JOIN CPTT.OPERATOR O ON D.ID_OPERATOR=O.ID  and O.ROLE=1
    INNER JOIN CPTT.ROUTE R ON T.id_route=R.ID AND T.id_division = R.id_division
 WHERE 
     T.CARD_SERIES  in (83) 
     and   O.CODE !='0080'
     --and O.CODE in ('0002','0003','0004','0005','0006','0007','0008','0009','0011','0012','0013','0014','0015','0016','0017','0018','0019','0020','0021','0022','0023','0024','0025','0026','0027','0028','0062')  
AND   T.KIND=17 
AND TO_CHAR(TRUNC(T.DATE_OF,'MM'), 'DDMMYYYY') = '01092016'
AND T.DATE_OF >= TO_DATE('01.09.2016 12:23:19','DD.MM.YYYY HH24:MI:SS')
AND T.DATE_OF <= TO_DATE('02.09.2016 14:15:48','DD.MM.YYYY HH24:MI:SS')
and T.CARD_NUM ='0003024299'
GROUP BY SUBSTR(T.CARD_NUM,2), O.CODE, T.AMOUNT, decode(R.ID_CODE_MSG,200001000,1,0) 
ORDER BY decode(R.ID_CODE_MSG,200001000,1,0),O.CODE, T.AMOUNT, SUBSTR(T.CARD_NUM,2) 


/*
--kontrol data
SELECT count(*) as tickets, SUM(kol_t) as TRIPS, MIN(minins), MAX(maxins) FROM (
SELECT T.CARD_NUM, count (*) as kol_t, MIN(T.INS_DATE) as minins, MAX(T.INS_DATE) as maxins
 FROM CPTT.T_DATA T
    INNER JOIN CPTT.DIVISION D ON T.ID_DIVISION=D.ID
    INNER JOIN CPTT.OPERATOR O ON D.ID_OPERATOR=O.ID  and O.ROLE=1
 WHERE 
     T.CARD_SERIES  in (83) 
     --and O.CODE in ('0002','0003','0004','0005','0006','0007','0008','0009','0011','0012','0013','0014'
    --                ,'0015','0016','0017','0018','0019','0020','0021','0022','0023','0024','0025','0026','0027','0028','0062'
--                    ,'0080'--Usolie
         --           ) 
and   O.CODE !='0080'
AND   T.KIND=17 
AND TO_CHAR(TRUNC(T.DATE_OF,'MM'), 'DDMMYYYY') = '01092016'
--AND T.INS_DATE < TO_DATE('01.09.2016  05:45:00','DD.MM.YYYY HH24:MI:SS')
--and T.CARD_NUM !=('0003027271')
GROUP BY T.CARD_NUM 
)
*/
--201609--
-- 17481   395198  01.09.2016 10:28:11 30.09.2016 23:13:08
-- 17482   395736  01.09.2016 10:28:11 02.10.2016 21:34:31 (20161003 9:30)
-- 17479   395743  01.09.2016 10:28:11 03.10.2016 12:21:10 (20161003 15:30)
-- 17477   395743  01.09.2016 10:28:11 03.10.2016 12:21:10 (20161003 17:47)
-- 17475   395811  01.09.2016 10:28:11 03.10.2016 17:40:33 (20161003 18:39)
-- 17475   395811  01.09.2016 10:28:11 03.10.2016 17:40:33 (20161003 22:52)
-- 17474   395808  01.09.2016 10:28:11 03.10.2016 17:40:33 (20161003 18:40) + 003027271  исключена, как не подтвержденная карта
---201608-------
--***************
--18218   658536  1-авг-2016 16:51:31 1-сен-2016 22:07:02 (20160905 09:18)
--18218   658536  01.08.2016 16:51:31 01.09.2016 22:07:02 (20160905 15:11)
--*******************************************
--18427 -689355 (20160302 23:13)
--18427 -689355 (20160303 08:33)
--18427 -689355 (20160309 12:27)

--march
--19962  -807001 (20160401 15:33)
--19962  -807780 (20160404 12:16)

--april 2016
--20157 840548 (20160502 16:37)
--20157 840548 (20160504 11:24)
--20157 840548 (20160518 14:12)
--20157   840548  01.04.2016 8:14:31  01.05.2016 21:06:18 (20160601 15:55)

--may 2016
--19533   747827 (20160601 15:34)
--19533   747827  01.05.2016 4:34:22  01.06.2016 6:22:58 (20160601 15:55)
--19533   748908  01.05.2016 4:34:22  01.06.2016 21:28:43(20160602 09:25)
--19533   748908  01.05.2016 4:34:22  01.06.2016 21:28:43 (20160602 17:05)
--19533   749251  1-май-2016 4:34:22  2-июн-2016 21:05:37 (20160607 10:41)!!!!!!

--june 2016
--19057   609594  01.06.2016 7:57:26  27.06.2016 10:28:47 (20160627 12:00)
--19134   690574  1-июн-2016 7:57:26  30-июн-2016 11:19:37 (20160630 12:17)
--19146   717213  1-июн-2016 7:57:26  30-июн-2016 23:08:31 (20160703 12:03)
--19146   717213  01.06.2016 7:57:26  30.06.2016 23:08:31 (20160704 07:00)
--19147   717220  01.06.2016 7:57:26  04.07.2016 9:35:10 (20160705 10:43)!!!!!!

--july 2016
-- 18577   527872  1-июл-2016 17:55:20 25-июл-2016 13:53:35 (20160725 15:50 all oper)
---18571   527866  1-июл-2016 17:55:20 25-июл-2016 13:53:35 (20160725 15:50 not in '0080')
-- 18722   687666  1-июл-2016 17:55:20 02-авг-2016 05:44:00 (20160802 12:40)
--18722    687666  01.07.2016 17:55:20 02.08.2016  05:44:00 (20160803 09:06)
--18722    687673  01.07.2016 17:55:20 04.08.2016  06:36:36 (20160804 09:23)!!!
 
